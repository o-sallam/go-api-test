package main

import (
	"fmt"
	"log"
	"net/http"
	"os"

	"go-api-test/handlers"
	"go-api-test/routes"
	"go-api-test/services"
)

const staticRoot = "wwwroot"

func main() {
	// Initialize MongoDB
	services.InitMongo()
	fmt.Println("MongoDB connected successfully.")
	if err := services.EnsurePostsCollection(); err != nil {
		log.Fatalf("Failed to ensure posts collection: %v", err)
	}
	fmt.Println("Posts collection ensured.")

	handlers.InitPostTemplates()

	// Insert dummy post
	// dummy := &models.Article{
	// 	Slug:    "kayfa-tasbah-mumayazan",
	// 	Title:   "كيف تصبح مميزا وهل من السهل الوصول للتميز!",
	// 	Excerpt: "لا بد انك قد تسالت يوما ما اذا كنت تختلف عن من حولك، هل اتميز بشئ!؟",
	// 	Content: `
	// <h1>كيف تصبح مميزا وهل من السهل الوصول للتميز!</h1>

	// <p>لا بد انك قد تسالت يوما ما اذا كنت تختلف عن من حولك , هل اتميز بشئ !؟ هل نتشابه في اشياء كثيرة فعلا ك  بشر ؟ . هل يوجد اختلافات اكثر تعقيدا مما نظن , هل يمكن ان اصبح بطلا , مميزا , او مشهورا في يوما من الايام . كل هذا الاسئلة الوجودية والفضولية سأتناقشها معكم واحدة بواحدة من وجهة نظري المتواضعة لكم اعزائي :) تابعو معي .</p>

	// <p>اولا يجب ان نعلم شئ يسمي المعيار طيلة حياتنا فلا احد ينكر اننا كلنا سوف نموت في يوم من الايام وان كل شخص له عدة اهداف يريد ان يحققها اثناء مسيرته الدنيوية , وهنا وجب التنويه بأن معايرنا في حد ذاتها مميزة بفضل الله نحن كمسلمون فنحن نبحث علي ما يدخلنا الجنة كهدف اساسي ونستعين بالاهداف الصغيرة في الدنيا التي تعيننا علي الوصول لذلك الهدف الكبير .</p>

	// <p>اطلت في المقدمة , والان سننتقل لنقاط موضوعنا.</p>

	// <h2>المحتويات</h2>
	// <ul>
	//   <li>العدل بين البشر</li>
	//   <li>الاختلاف بين البشر</li>
	//   <li>الفروق الفردية</li>
	//   <li>الاغلبية بين التميز والعادية!</li>
	//   <li>التلقيدية والكسل والتمييز اشعر انه مستحيل !</li>
	// </ul>

	// <h2>العدل بين البشر</h2>
	// <p>خلق الله سبحانه وتعالي الكثير من الصفات المتشابهة بيننا كبشر فالله سبحانه وتعالي خلق لنا السمع والبصر والعقل والكثير من الحواس التي تشترك بيننا نحن البشر في الصفات ولا يشذ الاقليل فالقليل من ابتلاه الله بفقد نعمة من بصره او غيرها من النعم , وهنا طالما نسير علي القيمة التي تحدثنا عليها مسبقا (الهدف الاسمي من الحياة) فالله سبحانه عادل يبدل من يفقده شئ بشئ اخر والله جل في علاه ليس ظلام للعبيد فيوم نلقاه ولا يوجد الا حسنات وسيئات يتساوي الجميع الا بالعمل وحتي النعيم في الدنيا يحاسبنا الله عليه كما قال تعالي: <q>ثُمَّ لَتُسْأَلُنَّ يَوْمَئِذٍ عَنِ النَّعِيمِ</q> -  وبهذا اتمني ان اكون وضحت جزءا عن القيم والتي سأتحدث عنها في موضوع قادم بأذن الله.</p>

	// <h2>الاختلاف بين البشر</h2>
	// <p>بالطبع يختلف البشر في الكثير من القدرات , وعندما اتحدث عن القدرات عزيزي القارئ فهي تختلف بكل ما تحتويه الكلمة من معني , في كل شئ قوة البصر , السمع , قدرات الحركة , الصحة الجسدية , وغيرها من القدرات الحواسية كالقدرة علي الاتزان , واكبر اختلاف يكمن في وجهة نظري في القدرات العقلية , فانت تتحدث علي فروقات شاسعة , نظرا للعديد من الابحاث الحديثة , يعتبر الذكاء الذي يعد مقياس قدرة العقل علي الاداء والانتاج , من 8 الي 12 نوعا من الذاكائات من ذكاء حركي ومنطقي وعقلي وغيرها والتي سأتحدث عنها في موضوع يطول لاحقا بأذن الله , نأتي الان للنقطة الاهم وهي مقدار الاختلاف الكبير في الابداع والتفكير وهذا سر اختلاف الميول والاذواق بين البشر – فلولا اختلاف الاذواق لبارت السلع- وهنا تستطيع ان تبحث بدقة عن ميزتك او ما تسمي بالموهبة وهنا وجب التنويه بأذن قدرة الرجل علي التركيز اكبر من النساء مثل قيادة السيارات والنساء اكثر قدرة علي التحليل مثل الاهتمام بالتفاصيل والقدرة علي شرح العبارات , ولكن هذا لا يمنع ان تكون هناك مرأة اكثر قدرة علي التركيز ممن حولها من الرجال او العكس , وهذا ما سنتحدث عنه في النقطة القادمة فيما يسمي بالفروق الفردية.</p>

	// <h2>الفروق الفردية</h2>
	// <p>اريد ان اتحدث معكم كمدرس بيولوجي (درست التحليل البيولوجي والتربوية والسيكولوجية علي حد سواء) تعلمت اشياء كثيرة في جامعتي لم استفد الكثير منها من وجهة نظري , ولكن اخذت ترن في عقلي عدت عبارات اخذت تتكرر مرارا وتكرارا علي اذني , مصطلحات تربوية تتكرر منذ ان كنت طالبا في الفرقة الاولي , ولكن الان استطيع ان افهمها واتدبرها , الفروق الفردية , نعم كانوا يعلمونا بأن يجب علي المعلم ان يتحترم الفروق الفردية بين الطلاب وقد تظن للوهلة الاولي ان هذه الفروق هي فروق في القدرات البصرية او العقلية وهكذا , ولكن اتضح لي ان هذا فااااارق كبير , اكبر من الفوارق التي تحدثت عنها سابقا . سأوضح لكم الموضوع اكثر , القدرات العقلية والسمعية وغيرها من القدرات المعروفة ليست فروقا , فكما ذكرنا سابقا في نقطة العدل فهي مشتركة منذ ان وجد الانسان علي الارض حتي يومنا هذا , ولكن ماذا تعني الفروق الفردية , بعد تحليل عميق وتدبر لهذه الكلمة مرت عبر سنوات مع اكتساب الخبرات , الفروق الفردية ببساطة هي ان كل طالب له اسلوبه الخاص , كل شخص خلقه الله له طريقته واسلوبه الخاصة التي يتميز بها عن الجميع , لا يجب ان تكون بارعا في العلوم او الرياضيات لتكون مميزا , لا يجب ان تكون نشيطا او مجتهدا في دراستك , ليست معيارا علي الاطلاق ( بغض النظر عن معايير القياس التعليمية التي اري بها كثيرا من الاخطاء بوجهة نظري) قد تشرح مسألة بأسلوبك , وقد يفهمها نصف التلاميذ ولا يفهمها النصف الاخر , ليس لان الطلاب الاخرين فشلة او غيير مميزين , علي الاطلاق قد يكون هذا سر تميزهم , قد يفهمونها بطريقة اخري لا يفهمهما النصف الاول , او قد يبتكر احدهم طريقة جديدة وافضل من كلا الطريقتين(واظنك الان تتذكر بعض العلماء الذين كانوا ضعفاء دراسيين وقدموا كثيرا لنا ) ولذلك الحكماء ينعزلون ليعيشوا عالمهم الخاص , ولهذا نتعلم دائما كمدرسين بتعدد المهارات واستخدام الوسائل التعليمية المختلفة , ارجو ان اكون قد وضحت معناها لكم , والان دعونا ننتفل للمشاكل التي تعيق الوصول للتميز.</p>

	// <h2>الاغلبية بين التميز والعادية!</h2>
	// <p>بالطبع يتميز القليل فقط , فسواء وجدت اشخاصا اغنياء او اشخاصا مشاهير او اشخاصا وصلو قدرا من مناصب العلم وغيرها , او يبتكر شيئا , يكتشف شيئا , والكثير مما نميزه , لن نتحدث عن ما اذا كان هذا نجاحا ام لا فهي تختلف حسب المعايير التي تحدثنا عنها سابقا والتي سبق وقلت اني سوف اتحدث عنها في موضوع اخر :) , والآن نعم يتميز القليل جدا والسبب هنا يرجع الي القيم المجتمعية التي نكتسبها , دعوني اوضح لكم اكثر , الانسان بطبعه انسان اجتماعي يتكسب الكثير من السلوكيات من البشر حوله ويتعلم الجديد منهم فهو علي عكس الحيوانات يوظف الكثير ممن يتعلمه ويجعله يتراكم وهذا ما يسمي بالخبرات , وهذا له ميزات قد نتحدث عنا مرة اخرة , ولكن من عيوب الاجتماعية , ان المجتمع يميل الي الكسل والتقليدية القيمية , وهنا انوه بأن الانسان المميز يتميز في بدايته حتي , اي انه غيّر اول معيار واختلف فيه عن الاخرين , وهو انه قرر ان لا يسير علي خطي الناس او ان يكون مجرد شخص عادي , دفعه الشغف , وقدراته الهائلة التي لا حدود لها التي خلقها الله له ( والتي يمتلكها انا وانت ) ووصل الي مراده بعد الكثير من الصبر والعناء والاجتهاد.</p>

	// <h2>التلقيدية والكسل والتمييز اشعر انه مستحيل !</h2>
	// <p>وهنا نعود للقيمة التي تسود , فالحقيقة قد تسأل نفسك ايها القارئ , هل هذا الكاتب قد حقق اي تميزا ام انه فقط يكتب شغفا , حقيقة الامر ذقت بعض التميز ولكن ليس التميز بمعناه الكبير , فهذا يرجع الي رضي نفسك وقيمك كما قلنا مسبقا , ولكن ما يهمنا هنا هو توضيح لماذا لا يتميز الكثير , العقل ببساطة هو جهاز عصبي يعمل علي ربط المواقف التي تتعرض اليها بالايجاب او السلب بروابط عصبية قوية وثابتة في دماغك , وبالتالي التميزات والنجاحات الكبيرة هي امور لا يستطيع ان يفعلها شخص دفعة واحدة , وبالتالي لا تستطيع ان تصنع روابط حقيقية وقوية تدفعك لهذا الهدف البعيد والمستحيل بوجهة نظرك , دعوني اوضح لكم بمثال , انت عندما تأكل طعام حلو , فأنه يترك لك اثرا ايجابيا يجعلك تريد ان تأكله مرارا وتكرارا والعكس اذا كان سيئا يترك اثرا سلبيا يجعلك لا تفعله ابدا , وبهذا تصنع روابط قوية عصبية في المخ , دعونا الان احكي تجربة صغيرة ستلخص الكثير مما اريد اقوله , انا قمت في الاشهر الاخيرة بالنزول بتدريب الجيم ورياضة رفع الاثقال , كان عندي هدف ان ازيد بالوزن ,ولكن كنت اتكاسل ان اذهب , شجعني احد اصدقائي لاذهب , بت اذهب الفترة الاولي مع صديقي الذي كان يئجعني لانه احد اهم اصدقائي كنت احب ان اقضي الوقت اتنافس معه في هذا المكان ولم يكن في بالي اني استطيع ان اقحقق اي اهداف هنا , حتي اني كنت اعاني في الفترة الاولي التمارين القاسية, وبعد فترة ذهب صديقي وسافر لقضاء اشغاله , بدأت اشعر بشئ غريب , لم تعد التمارين صعبة , وبدأ يظهر علي بعض العضلات , بل حتي ان التمارين لم تعد صعبة بل علي العكس اصبحت ممتعة , كأنك تلعب جيم علي الكمبيوتر , قمت بالاستمرار , اصبحت اعد الكثر من عدات الضغط ولعبة العقلة ولا اشعر بأي صعوبة ( علي عكس البداية ) اصبح الكثر ممكن حولي من زملائي يخبرني لم تصبح نحيفا لقد اصبحت ممشوقا , وكذا وكذا , يعطيني حافزا حتي استمررت الي هذا اليوم الذي اكتب فيه المقالة , ملخص الموضوع , انك يجب ان تبدأ وتجعل لك محفزا لك في بداية الطريق , يجب ان تستخدم الاهداف الصغيرة مثلما كنت استمتع انا بالتمارين ولم اكن افكر في بناء جسم قوي , وهكذا انا اسير الي هدفي الكبير بدون ان اشعر وبدون ملل بل بشغف , لتحقق بها الاهداف الكبيرة , مثلما تحدثنا عن الهدف الكبير من الحياة وهكذا تحققه .</p>

	// <p><strong>ملحوظة:</strong> لا يوجد ادني علاقة بين النجاح والتميز . :) استغفر الله لي ولكم , واسأل الله الجنة لي والجميع.</p>
	// `,
	// 	Category:   "تطوير الذات",
	// 	Tags:       []string{"تميز", "نجاح", "تطوير الذات", "تحفيز"},
	// 	Author:     models.Author{ID: "1", Name: "Omar Khaled"},
	// 	CoverImage: "/img/blog/achievement.webp",
	// 	Views:      1500,
	// 	CreatedAt:  "2025-07-03T09:00:00Z",
	// 	UpdatedAt:  "2025-07-04T12:00:00Z",
	// 	Published:  true,
	// }

	// insertedID, err := services.AddPost(dummy)
	// if err != nil {
	// 	log.Printf("Failed to insert dummy post: %v", err)
	// } else {
	// 	fmt.Printf("Dummy post inserted with ID: %v\n", insertedID)
	// }

	// Load HTML at startup (no minify)
	htmlBytes, err := os.ReadFile(staticRoot + "/index.html")
	if err != nil {
		log.Fatalf("Failed to load index.html: %v", err)
	}
	handlers.SetPortfolioHTML(string(htmlBytes))

	mux := http.NewServeMux()
	routes.RegisterRoutes(mux, staticRoot, "")

	port := os.Getenv("PORT")
	if port == "" {
		port = "8080"
	}
	fmt.Printf("Server starting on port %s...\n", port)
	fmt.Printf("Try: http://localhost:%s/\n", port)
	fmt.Printf("Health check: http://localhost:%s/health\n", port)

	log.Fatal(http.ListenAndServe(":"+port, mux))
}
